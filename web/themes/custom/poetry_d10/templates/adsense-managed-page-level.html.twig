{#
  Theme override for AdSense auto ads (page-level) to prevent duplicate initialization.
  Google AdSense throws: "Only one 'enable_page_level_ads' allowed per page." if the
  page-level init is executed more than once. This template guards the init so it
  only runs a single time even if the block is placed multiple times on a page.
#}
{% if not defer %}
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-{{ client }}"
     crossorigin="anonymous"></script>
{% else %}
  {{ attach_library('adsense/adsense.adsbygoogle') }}
{% endif %}
<script>
  (function() {
    // Ensure the page-level ads initialization runs only once per page.
    if (!window.__adsbygooglePageLevelInitialized) {
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-{{ client }}",
        enable_page_level_ads: true
      });
      window.__adsbygooglePageLevelInitialized = true;
    }
  })();
</script>
